<!--
    TODO
    окно добавляения локального файла для подсчета
    принимает json от сервера со списком локальных видео файлов (папка ключ, массив video files only!!!)
    примает  картинку из видеофайла от сервера
    отображает картинку внизу панели о файле
    опции
        путь к файлу - сделать окно поиска
        границы (загрузить из существующей камеры или создать новые)
        опция: сохранять результируещее видео - путь, разрешение
-->

<html>
<head>
    <meta charset="UTF-8">
    <title>"Wingu"</title>
    <link rel="icon" type="image/png" href="lib/favicon.png">
    <script src="lib/jquery-3.5.1.min.js"></script>
    <link href="lib/bootstrap.min.css" rel="stylesheet">
    <link href="lib/flag-icon.min.css" rel="stylesheet">
    <link rel="stylesheet" href="lib/css/all.css">

    <script src="lib/bootstrap.min.js"></script>
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.1.0/css/flag-icon.min.css" rel="stylesheet">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script> -->
    <!-- <script src="js/websocket.js"></script> -->

    <script src="js/nav.js"></script>
    <script src="js/websocket.js"></script>
    <script>
        var curVideoFilePath = 'video/39.avi';
        // json data structure:  name, size in GB, creaction time
        var fileList;

        function getFileImg(videoPath) {
            if (wsCmd != null) {
                if (wsCmd.readyState == 1) {
                    wsCmd.send(JSON.stringify({ cmd: 'getFileImag', data: videoPath }));
                    
                } else {
                    console.log("Websocket is not ready. Wait a sec.")
                    setTimeout(() => { getFileImg(videoPath); }, 500);
                }
            } else { console.log("Error websocket does not exist!!"); }
        }


        function getFilesListAjax() {
            var jqxhr = $.ajax("http://localhost:8080/filesList")
                .done(function (data) {
                    console.log("success ajax", data);
                    try {
                        fileList = JSON.parse(data);
                        console.log("success ajax json", fileList);
                    } catch{
                        console.log("error ajax json!!!");
                    }
                    //data.files.forEach((row) => { addRow(row); });
                })
                .fail(function () { console.log("error get ajax"); })
                .always(function () { console.log("complete ajax request"); });
        }

        var filesScreens;
        function getFileScreenshotsAjax(filePath) {
            var jqxhr = $.ajax("http://localhost:8080/fileImgs?" + filePath)
                .done(function (data) {
                    console.log("success ajax", data);
                    try {
                        fileList = JSON.parse(data);
                        console.log("success ajax json", fileList);
                    } catch{
                        console.log("error ajax json!!!");
                    }
                    //data.files.forEach((row) => { addRow(row); });
                })
                .fail(function () { console.log("error get ajax"); })
                .always(function () { console.log("complete ajax request"); });
        }
        $(document).ready(function () {
            //getFileScreenshotsAjax("file_1=39.avi");
            if (wsCmd == null) { WebSocketCmd(); }
            getFileImg('video/39.avi');
            
        });
    </script>
</head>
<body>
    <div id="menu"></div>
    <h1 id="headMain"></h1>
    <div class="container">
        <div class="card">
            <div class="card-body">
                <b>Hardware status: </b>
                <span class="badge badge-primary">CPU <span id="cpu">0</span>%</span>
                <span class="badge badge-primary">CPU <span id="cpu_t">0</span>&deg;</span>
                <span class="badge badge-primary">Mem <span id="mem_load">0</span>%</span>
                <span class="badge badge-primary">Drive <span id="drive_free">0</span>GB</span>
                <span class="badge badge-primary">GPU1 <span id="1gpu">0</span>%</span>
                <span class="badge badge-primary">GPU1 <span id="1gpu_t">0</span>&deg;</span>
                <span class="badge badge-primary">GPU1 <span id="1gpu_mem">0</span>GB</span>
                <span class="badge badge-primary">GPU2 <span id="2gpu">0</span>%</span>
                <span class="badge badge-primary">GPU2 <span id="2gpu_t">0</span>&deg;</span>
                <span class="badge badge-primary">GPU2 <span id="2gpu_mem">0</span>%</span>
            </div>
        </div>
        <br>
        <div class="card">
            <div class="card-header">Local file proceeding queue</div>
            <div class="card-body">
                <table class="table text-center">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Path</th>
                            <th scope="col">Size (MB)</th>
                            <th scope="col">Done (%)</th>
                            <th scope="col">Working (min)</th>
                            <th scope="col">Finished in (min)</th>
                            <th scope="col">Stop</th>
                            <th scope="col">Up|Down</th>
                            <th scope="col">Displey</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="0_'queue">
                            <td id="0_queue_n">1</td>
                            <td id="0_queue_path">39.avi</td>
                            <td id="0_queue_size">0</td>
                            <td>
                                <div class="progress"><div id="0_queue_done" class="progress-bar" role="progressbar" style="width:10%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></div>
                                <!--
                                    $('0_queue_done').css('width', valeu+'%').attr('aria-valuenow', valeu);
                                 -->
                            </td>
                            <td id="0_queue_proceed">0</td>
                            <td id="0_queue_finish">0</td>
                            <td><a href="" style="color:red"><span class="fas fa-minus-circle"></span></a></td>
                            <td><a href="" id="0queue_n"><span class="fas fa-chevron-up"></span></a>&nbsp;&nbsp;<a href=""><span class="fas fa-chevron-down"></span></a></a></td>
                            <td>Show</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <br>
        <div class="card">
            <div class="card-header bg-secondary text-white">Add a video file to the queue</div>
            <div class="card-body">
                <div id="content">
                    <form>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Video file</span>
                            </div>
                            <input type="text" class="form-control" id="inputFilePath01" value="39.avi">
                        </div>

                        <div class="input-group mb-3">
                            <form class="form-inline mb-3">
<!--                                <div class="input-group  w-25">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Display result video</span>
                                        <span class="input-group-text"><input type="checkbox" aria-label="Display video here"></span>
                                    </div>
                                </div>-->
                                <div class="input-group  w-50">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Proceed each n frame</span>
                                    </div>
                                    <input type="number" class="form-control" id="file_skip" value=4 />
                                </div>
                            </form>
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Inform when will be completed by emails:</span>
                            </div>
                            <input type="text" class="form-control" id="file_emails" placeholder="admin@gmail.com, user@gmail.com">
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Save result video</span>
                                <span class="input-group-text"><input type="checkbox" aria-label="Save video to file"></span>
                            </div>
                            <input type="text" class="form-control" id="file_save" placeholder="" />
                            <div class="input-group-append">
                                <select class="custom-select" id="inlineFormCustomSelectPref">
                                    <option selected value="0">320p</option>
                                    <option value="1">480p</option>
                                    <option value="2">720p</option>
                                </select>
                            </div>
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend"><span class="input-group-text">Borders:</span></div>
                            <input type="text" id="file_borders" class="form-control" value="0" readonly />

                            <div class="input-group-append">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick=" $('#fileModal').modal('show');">Edit</button>
                            </div>
                        </div>

                        <button type="button" class="btn btn-primary" data-dismiss="modal">Add to queue</button>
                    </form>
                </div>
            </div>


            <!--
            <label>Progress result:</label>

            <br>
                -->
        </div>

    </div>
    <br><br><br>
    <!-- Modal -->
    <div class="modal fade" id="fileModal" tabindex="-1" role="dialog" aria-labelledby="ModalDelete" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModalDelete">Are you want delete camera config?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Skip</button>
                    <button type="button" class="btn btn-danger" onclick="delCamera(); return false;">Delete</button>
                </div>
            </div>
        </div>
</body>
</html>